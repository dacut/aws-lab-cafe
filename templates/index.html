{% extends "frame.html" %}
{% block title %}Home{% endblock %}
{% block navbar_home_class %}active{% endblock %}
{% block navbar_home_link %}#{% endblock %}
{% block body_container %}
<div class="row">
  <div class="col-xs-12 col-sm-6">
    <h2>Access Information</h2>
    <table class="table">
      <tr>
        <th class="instance-headers">Instance ID</th>
        <td>
          {%- if instance_id -%}
          {{- instance_id -}}
          {%- else -%}
          You don't have an instance assigned to you. <br>
          <form name="launch-ec2" action="/ec2" method="POST">
            <div class="form-group">
              <button type="submit" class="btn btn-success">Launch EC2 Instance</button>
            </div>
            <input type="hidden" name="Action" value="Launch">
            <input type="hidden" name="_csrf_token" value="{{csrf_token()}}">
          </form>
          {%- endif -%}
        </td>
      </tr>
      <tr>
        <th>IP Address</th>
        <td>{% if instance_info %}{{instance_info["PublicIpAddress"]|e}}{% endif %}</td>
      </tr>
      <tr>
        <th>Instance State</th>
        <td>
          {%- if instance_info -%}
          {{- instance_info["State"]["Name"]|e -}}
          {%- if datetime.now(tzutc()) - instance_info["LaunchTime"] < timedelta(minutes=5) -%}
          <br><em>Your EC2 instance was recently launched and might still be bootstrapping; SSH might not yet be available.</em>
          {%- endif -%}
          {%- endif -%}</td>
      </tr>
      <tr>
        <th>Launch Time</th>
        <td>{% if instance_info %}{{instance_info["LaunchTime"].strftime("%b %d %Y %H:%M:%S UTC")}}{% endif %}</td>
      </tr>
      <tr>
        <th>Username</th>
        <td>{{"lab%s" % user["UserId"]|e}}</td>
      </tr>
      <tr>
        <th>SSH Private Key</th>
        <td>
          <a class="btn btn-primary" href="/ssh-key?format=PEM" role="button">Download for Mac/Linux</a><br>
          <a class="btn btn-primary" href="/ssh-key?format=PPK" role="button">Download for Windows (PuTTY)</a><br>
        </td>
      </tr>
    </table>
  </div>
  <div class="col-xs-12 col-sm-6">
    <h2>Connection Instructions</h2>
    <ul class="nav nav-tabs">
      <li role="presentation" class="active"><a href="#mac-instructions" aria-controls="mac-instructions" role="tab" data-toggle="tab">Mac</a></li>
      <li role="presentation"><a href="#linux-instructions" aria-controls="linux-instructions" role="tab" data-toggle="tab">Linux</a></li>
      <li role="presentation"><a href="#windows-instructions" aria-controls="windows-instructions" role="tab" data-toggle="tab">Windows</a></li>
    </ul>
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="mac-instructions">
        <ol>
          <li>Download your SSH key by clicking on "Download for Mac/Linux" on the left.</li>
          <li>Open up a terminal. This will be in <b>Applications &gt; Utilities &gt; Terminal</b>.
            <img src="{{static_prefix}}images/macos-terminal-launch.png" width="600" height="304">
          </li>
          <li>Locate the SSH private key file. This is usually <br>
            <code>~/Downloads/{{user["EventId"]}}-private.pem</code></li>
          <li>Make the SSH private key file unreadable by others:<br>
            <code>chmod 600 ~/Downloads/{{user["EventId"]}}-private.pem</code>
          </li>
          <li>SSH into the host using this key and your username at the left:<br>
            <code>ssh -i ~/Downloads/{{user["EventId"]}}-private.pem {{"lab%d" % user["UserId"]}}@
              {%- if instance_info and instance_info["PublicIpAddress"] -%}
                {{- instance_info["PublicIpAddress"] -}}
              {%- else -%}
                <em>a.b.c.d</em>
              {%- endif -%}
            </code>
          </li>
        </ol>
      </div>
      <div role="tabpanel" id="linux-instructions" class="tab-pane">
        <ol>
          <li>Download your SSH key by clicking on "Download for Mac/Linux" on the left.</li>
          <li>Open up a terminal. On Ubuntu Linux, click on the Ubuntu logo in the upper left corner and search for "terminal". Click on the Terminal icon.
            <img src="{{static_prefix}}images/ubuntu-terminal-launch.png" width="411" height="245">
          </li>
          <li>Locate the SSH private key file. This is usually<br>
            <code>~/Downloads/{{user["EventId"]}}-private.pem</code></li>
          <li>Make the SSH private key file unreadable by others:<br>
            <code>chmod 600 ~/Downloads/{{user["EventId"]}}-private.pem</code>
          </li>
          <li>SSH into the host using this key and your username at the left:<br>
            <code>ssh -i ~/Downloads/{{user["EventId"]}}-private.pem {{"lab%d" % user["UserId"]}}@
              {%- if instance_info and instance_info["PublicIpAddress"] -%}
                {{- instance_info["PublicIpAddress"] -}}
              {%- else -%}
                <em>a.b.c.d</em>
              {%- endif -%}
            </code>
          </li>
        </ol>
      </div>
      <div role="tabpanel" id="windows-instructions" class="tab-pane">
      </div>
    </div>
  </div>
</div>
{% endblock body_container %}
